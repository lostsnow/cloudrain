if(!Tomato)var Tomato={};Tomato.WebSocketClient=function(e){e=e||{},this.number=0,this.autoReconnectRetry=0,e.autoReconnectMaxRetry||(e.autoReconnectMaxRetry=10),this.autoReconnectMaxRetry=e.autoReconnectMaxRetry,e.autoReconnectInterval||(e.autoReconnectInterval=15e3),this.autoReconnectInterval=e.autoReconnectInterval,this.options=e},Tomato.WebSocketClient.prototype.open=function(e){var t=this;this.url=e,this.instance=new WebSocket(this.url),this.instance.onopen=function(){t.onopen(),t.reconnectTimeout&&(t.autoReconnectRetry=0,t.autoReconnectInterval=t.options.autoReconnectInterval,clearTimeout(t.reconnectTimeout))},this.instance.onmessage=function(e,o){t.number++,t.onmessage(e,o,this.number)},this.instance.onclose=function(e){switch(t.onclose(e),e.code){case 1e3:console.log("WebSocket: closed");break;default:t.reconnect(e)}},this.instance.onerror=function(e){switch(e.code){case"ECONNREFUSED":t.reconnect(e);break;default:t.onerror(e)}}},Tomato.WebSocketClient.prototype.send=function(e){try{this.instance.send(e)}catch(e){this.instance.emit("error",e)}},Tomato.WebSocketClient.prototype.close=function(e,t){try{this.instance.close(e,t)}catch(e){this.instance.emit("error",e)}},Tomato.WebSocketClient.prototype.reconnect=function(e){if(!(this.autoReconnectInterval<=0||this.autoReconnectRetry>=this.autoReconnectMaxRetry)){var t=this.autoReconnectInterval*(1+Math.log(this.autoReconnectRetry+1));console.log("WebSocketClient: retry in "+t+"ms",e),this.instance.removeEventListener("open",this.instance.onopen),this.instance.removeEventListener("message",this.instance.onmessage),this.instance.removeEventListener("close",this.instance.onclose),this.instance.removeEventListener("error",this.instance.onerror);var o=this;this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),o.onreconnect(t),this.reconnectTimeout=setTimeout(function(){console.log("WebSocketClient: reconnecting..."),o.autoReconnectRetry++,o.open(o.url)},t)}},Tomato.WebSocketClient.prototype.onopen=function(e){console.log("WebSocketClient: open",arguments)},Tomato.WebSocketClient.prototype.onmessage=function(e,t,o){console.log("WebSocketClient: message",arguments)},Tomato.WebSocketClient.prototype.onerror=function(e){console.log("WebSocketClient: error",arguments)},Tomato.WebSocketClient.prototype.onclose=function(e){console.log("WebSocketClient: closed",arguments)},Tomato.WebSocketClient.prototype.onreconnect=function(e){console.log("WebSocketClient: reconnect",arguments)},Tomato.cookie={set:function(e,t,o){var n="";if(o){var c=new Date;c.setTime(c.getTime()+1e3*o),n="; expires="+c.toUTCString()}document.cookie=e+"="+(t||"")+n+"; path=/"},get:function(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var c=o[n];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(t))return c.substring(t.length,c.length)}return null},delete:function(e){document.cookie=e+"=; Max-Age=-99999999;"}},Tomato.GetUrlParameter=function(e){var t,o,n=window.location.search.substring(1).split("&");for(o=0;o<n.length;o++)if((t=n[o].split("="))[0]===e)return void 0===t[1]||decodeURIComponent(t[1])},Tomato.EscapeHtml=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},Tomato.CopySelect=function(){window.document.queryCommandSupported&&window.document.queryCommandSupported("copy")&&window.document.execCommand("copy")};